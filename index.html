<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>حاسبة المعدل التراكمي</title>
<style>
  body {
    font-family: Tahoma, Arial, sans-serif;
    margin: 0;
    padding: 0;
    background: #f9f9f9;
    color: #222;
  }
  header {
    background: #0059b3;
    color: #fff;
    padding: 15px;
    text-align: center;
  }
  h1 { margin: 0; font-size: 1.4rem; }

  .container {
    padding: 15px;
    max-width: 900px;
    margin: auto;
  }

  .card {
    background: #fff;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 15px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.1);
  }

  label { font-weight: bold; display: block; margin-bottom: 5px; }
  input, select, button {
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    font-size: 1rem;
    border: 1px solid #ccc;
    border-radius: 6px;
    box-sizing: border-box;
  }

  button {
    background: #0059b3;
    color: #fff;
    cursor: pointer;
    border: none;
  }
  button:hover { background: #004080; }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
    font-size: 0.9rem;
  }
  th, td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: center;
  }
  th { background: #f1f1f1; }

  .results {
    font-size: 1rem;
    line-height: 1.8;
  }

  /* 📱 موبايل: تصغير الجدول */
  @media (max-width: 600px) {
    table, thead, tbody, th, td, tr { display: block; }
    thead tr { display: none; }
    tr {
      margin-bottom: 12px;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 8px;
    }
    td {
      border: none;
      text-align: right;
      padding: 6px 4px;
    }
    td:before {
      content: attr(data-label);
      font-weight: bold;
      display: block;
      margin-bottom: 2px;
      color: #0059b3;
    }
  }
</style>
</head>
<body>

<header>
  <h1>📊 حاسبة المعدل التراكمي</h1>
</header>

<div class="container">

  <div class="card">
    <label for="scale">سلم الدرجات:</label>
    <select id="scale">
      <option value="4">4.0</option>
      <option value="5">5.0</option>
    </select>

    <label for="gradeMode">طريقة إدخال الدرجة:</label>
    <select id="gradeMode">
      <option value="letter">حروف (A, B+ ...)</option>
      <option value="percent">نسبة مئوية (%)</option>
    </select>

    <label for="prevHours">ساعات سابقة مجتازة:</label>
    <input id="prevHours" type="number" placeholder="مثال: 84" />

    <label for="prevGpa">المعدل السابق:</label>
    <input id="prevGpa" type="number" step="0.01" placeholder="مثال: 3.21" />
  </div>

  <div class="card">
    <button id="addRow">+ إضافة مقرر</button>
    <table id="coursesTable">
      <thead>
        <tr>
          <th>#</th>
          <th>اسم المقرر</th>
          <th>الساعات</th>
          <th class="th-letter">الدرجة (حرف)</th>
          <th class="th-percent" style="display:none">الدرجة (%)</th>
          <th>النقاط</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>

  <div class="card results">
    <p><strong>ساعات الفصل:</strong> <span id="termHours">0</span></p>
    <p><strong>المعدل الفصلي:</strong> <span id="termGpa">0.000</span></p>
    <hr>
    <p><strong>الساعات الكلية:</strong> <span id="cumHours">0</span></p>
    <p><strong>المعدل التراكمي:</strong> <span id="cumGpa">0.000</span></p>
  </div>

</div>

<script>
const tbody = document.getElementById('tbody');
const addRowBtn = document.getElementById('addRow');
const gradeMode = document.getElementById('gradeMode');
const scaleSel  = document.getElementById('scale');
const prevHours = document.getElementById('prevHours');
const prevGpa   = document.getElementById('prevGpa');

function letterToPoints(letter, scale) {
  letter = letter.toUpperCase();
  if(scale==4){
    const map = {'A':4,'A-':3.7,'B+':3.3,'B':3,'B-':2.7,'C+':2.3,'C':2,'C-':1.7,'D+':1.3,'D':1,'F':0};
    return map[letter] ?? 0;
  } else {
    const map = {'A':5,'A-':4.75,'B+':4.5,'B':4,'C+':3.5,'C':3,'D+':2.5,'D':2,'F':0};
    return map[letter] ?? 0;
  }
}

function percentToPoints(p, scale) {
  p = Number(p);
  if(scale==4){
    if(p>=93) return 4; if(p>=90) return 3.7; if(p>=87) return 3.3; if(p>=83) return 3;
    if(p>=80) return 2.7; if(p>=77) return 2.3; if(p>=73) return 2; if(p>=70) return 1.7;
    if(p>=67) return 1.3; if(p>=63) return 1; if(p>=60) return 0.7; return 0;
  } else {
    if(p>=95) return 5; if(p>=90) return 4.75; if(p>=85) return 4.5; if(p>=80) return 4;
    if(p>=75) return 3.5; if(p>=70) return 3; if(p>=65) return 2.5; if(p>=60) return 2; return 0;
  }
}

function addRow() {
  const idx = tbody.children.length+1;
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td data-label="#">${idx}</td>
    <td data-label="اسم المقرر"><input type="text"></td>
    <td data-label="الساعات"><input type="number" min="0" step="0.5"></td>
    <td class="td-letter" data-label="الدرجة (حرف)">
      <select>
        <option value="">--</option>
        <option>A</option><option>A-</option><option>B+</option><option>B</option><option>B-</option>
        <option>C+</option><option>C</option><option>C-</option><option>D+</option><option>D</option><option>F</option>
      </select>
    </td>
    <td class="td-percent" style="display:none" data-label="الدرجة (%)"><input type="number" min="0" max="100"></td>
    <td data-label="النقاط" class="points">0.000</td>
    <td><button class="remove">🗑️</button></td>
  `;
  tbody.appendChild(tr);
  tr.querySelectorAll('input,select').forEach(el => el.addEventListener('input', recalc));
  tr.querySelector('.remove').addEventListener('click', ()=>{ tr.remove(); recalc(); });
  recalc();
}

function recalc() {
  let termH=0, termP=0;
  [...tbody.children].forEach(tr=>{
    const h = Number(tr.querySelector('td:nth-child(3) input').value) || 0;
    let gp=0;
    if(gradeMode.value=='letter'){
      const l = tr.querySelector('.td-letter select').value;
      gp = letterToPoints(l, Number(scaleSel.value));
    } else {
      const p = tr.querySelector('.td-percent input').value;
      gp = percentToPoints(p, Number(scaleSel.value));
    }
    const qp = h*gp;
    termH += h; termP += qp;
    tr.querySelector('.points').textContent = qp.toFixed(3);
  });
  const termG = termH? (termP/termH):0;
  const ph=Number(prevHours.value)||0, pg=Number(prevGpa.value)||0;
  const cumH=ph+termH, cumG= cumH? ((ph*pg+termP)/cumH):0;
  document.getElementById('termHours').textContent=termH.toFixed(1);
  document.getElementById('termGpa').textContent=termG.toFixed(3);
  document.getElementById('cumHours').textContent=cumH.toFixed(1);
  document.getElementById('cumGpa').textContent=cumG.toFixed(3);

  // تبديل العمود
  [...tbody.children].forEach(tr=>{
    tr.querySelector('.td-letter').style.display = gradeMode.value=='letter'?'block':'none';
    tr.querySelector('.td-percent').style.display = gradeMode.value=='percent'?'block':'none';
  });
  document.querySelector('.th-letter').style.display = gradeMode.value=='letter'?'':'none';
  document.querySelector('.th-percent').style.display = gradeMode.value=='percent'?'':'none';
}

addRowBtn.addEventListener('click', addRow);
[gradeMode,scaleSel,prevHours,prevGpa].forEach(el=>el.addEventListener('input', recalc));
</script>
</body>
</html>
